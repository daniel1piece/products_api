// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

/// Prisma installation steps
/// npm i prisma @prima/client

generator client {
  provider = "prisma-client"
}

datasource db {
  provider = "mysql"
}

/// COmentario en prisma
/// Tabla de usuarios
model User {
  /// PK: id BigInt autoincrement
  id         BigInt     @id @default(autoincrement())
  /// Correo unico
  email      String     @unique @db.VarChar(200)
  /// Contrase√±a
  password   String     @db.VarChar(200)
  /// Estado 
  status     Int        @default(1) @db.TinyInt
  /// timestamp
  created_at DateTime   @default(now()) @db.DateTime(6)
  updated_at DateTime   @updatedAt @db.DateTime(6)
  deleted_at DateTime?  @db.DateTime(6)  

  /// Relationships with other tables (foreign keys)
  /// 1 - to - many Relationships
  orders     Order[]
  products   Product[]
  /// 1 to 1 Relationships
  profile    Profile? /// optional field add - '?'
  // this is the name the table will have on the db.
  @@map("users")
}

model Profile {
  id          BigInt      @id @default(autoincrement())
  
  bio         String?     @db.Text
  phone       String?     @db.VarChar(50) 
   /// Estado 
  status      Int        @default(1) @db.TinyInt
  /// timestamp
  created_at   DateTime   @default(now()) @db.DateTime(6)
  updated_at   DateTime   @updatedAt @db.DateTime(6)
  deleted_at   DateTime?  @db.DateTime(6)     

  /// Relationships  
  /// 1 - to - 1
  userId User @relation(fields: [user_id], references: [id])
  user_id     BigInt      @unique

  /// name of the table in db
  @@map("profiles")
}

model Category {
  id            BigInt      @id @default(autoincrement())
  name          String      @db.VarChar(150)
  description   String?     @db.Text
   /// Estado 
  status        Int         @default(1) @db.TinyInt
  /// timestamp
  created_at    DateTime    @default(now()) @db.DateTime(6)
  updated_at    DateTime    @updatedAt @db.DateTime(6)
  deleted_at    DateTime?   @db.DateTime(6) 
  // 1 - to - many Relationship
  products Product[]

  @@map("categories")
}

/// Productos
model Product {
  id          BigInt          @id @default(autoincrement())
  sku         String          @unique @db.VarChar(100)
  name        String          @db.VarChar(200)
  description String?         @db.Text
  price       Float           
  stock       Int             
  is_digital  Boolean         @default(false)
  /// Estado 
  status     Int              @default(1) @db.TinyInt
  /// timestamp
  created_at DateTime         @default(now()) @db.DateTime(6)
  updated_at DateTime         @updatedAt @db.DateTime(6)
  deleted_at DateTime?        @db.DateTime(6) 

  Category_id   BigInt?
  user_id       BigInt?
  order_item    OrderItem[]
  product_tags  ProductTag[]       
  Category      Category?     @relation(fields: [Category_id], references: [id])
  user          User?         @relation(fields: [user_id], references: [id])

  /// Creating indixes of this Relationship
  @@index([Category_id], map: "products_category_id_fkey")
  @@index([user_id], map: "products_owner_id_fkey")
  /// Name of table in db
  @@map("products")
}

// Tag
model Tag {
   id          BigInt          @id @default(autoincrement())
   name        String          @db.VarChar(100)
   status      Int             @default(1) @db.TinyInt
  /// timestamp
  created_at DateTime         @default(now()) @db.DateTime(6)
  updated_at DateTime         @updatedAt @db.DateTime(6)
  deleted_at DateTime?        @db.DateTime(6) 

  product_tags ProductTag[]

  @@map("tags")
}

/// Product Tags 
model ProductTag {
  id          BigInt          @id @default(autoincrement())
  product_id  BigInt
  tag_id      BigInt
   /// Estado 
  status      Int              @default(1) @db.TinyInt
  /// timestamp
  created_at DateTime         @default(now()) @db.DateTime(6)
  updated_at DateTime         @updatedAt @db.DateTime(6)
  deleted_at DateTime?        @db.DateTime(6) 


  prouct     Product          @relation(fields: [product_id], references: [id])
  tag        Tag              @relation(fields: [tag_id], references: [id])

  @@unique([product_id, tag_id])
  @@index([tag_id], map: "product_tag_tag_id_fkey")
  @@map("product_tags")
}

/// Order

model Order {
  id          BigInt          @id @default(autoincrement())
  user_id     BigInt          
  total       Float
  /// Estado 
  status     Int              @default(1) @db.TinyInt
  /// timestamp
  created_at DateTime         @default(now()) @db.DateTime(6)
  updated_at DateTime         @updatedAt @db.DateTime(6)
  deleted_at DateTime?        @db.DateTime(6) 

  items     OrderItem[]
  user      User              @relation(fields: [user_id], references: [id])

  @@index([user_id], map: "orders_user_id_fkey")
  @@map("orders")
}

/// OrderItem
model OrderItem {
  id          BigInt          @id @default(autoincrement())
  order_id    BigInt
  product_id  BigInt
  quantity    Int
  price       Float
  /// Estado 
  status     Int              @default(1) @db.TinyInt
  /// timestamp
  created_at DateTime         @default(now()) @db.DateTime(6)
  updated_at DateTime         @updatedAt @db.DateTime(6)
  deleted_at DateTime?        @db.DateTime(6) 

  order       Order     @relation(fields: [order_id], references: [id])
  product     Product   @relation(fields: [product_id], references: [id])

  @@index([order_id], map: "order_items_order_id_fkey")
  @@index([product_id], map: "order_items_product_id_fkey")
  @@map("order_items")
}

/// npx prisma validate
/// The above command helps us check if our migrations are ready
// if there's any mistake, it will hightlight it and
// we will need to correct it after that we will be able to run the
// migration by following the below command

/// We should have initialized the prima client npx prisma generate at the beginning